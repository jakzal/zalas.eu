---
layout: post
title: Learning Symfony2 by Unit Testing (Contribute to Learn)
tags:
- contributing
- php
- phpunit
- Symfony2
- testing
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  description: During the Hacking Day on the Symfony Live conference I decided to
    write some unit tests for Symfony2. I didn't expect that writing tests for an
    existing piece of software can be so much fun. What I also discovered is that
    it is a great way to learn Symfony2 internals.
  keywords: test,Symfony2,phpunit,testing,learning,contributing
---
<p style="text-align: left;"><img class="aligncenter size-full wp-image-642" title="Learning Symfony2 by Unit Testing (Contribute to Learn)" src="/uploads/wp/2011/03/unit-testing.png" alt="" width="599" height="200" /></p>
<p style="text-align: left;">During the Hacking Day on the <a title="Symfony Live 2011 in Paris" href="http://www.zalas.eu/symfony-live-2011">Symfony Live conference</a> I decided to give it a try and write some unit tests for <a title="Symfony" href="http://symfony.com">Symfony2</a>. I'm a big fan of TDD for quite some time already and I recently became really interested in BDD. For sure I'm not new to unit testing. Still, <strong>I didn't expect that writing tests for an existing piece of software can be so much fun</strong>.</p>
What I also discovered is that writing unit tests for Symfony is a great way to learn its internals.
<h2>Contribute to Learn</h2>
The process of writing tests is no doubt a contribution. What's less obvious it's an <strong>occasion to learn</strong> as well.

Before we can even start with writing a test we need to dig into an existing ones to see how they're built. Reading the tests teaches us how classes and components should be used. This way we're learning the API.

Next we should analyze the class we plan to cover by tests. Doing this we're learning about Symfony internals quite extensively. We have to understand the code very well before writing anything.

The good part is we don't have to learn the whole framework at once. As it's pretty <strong>well structured</strong> and <strong>decoupled to components</strong> we can take a really <strong>small steps</strong>. Class after class. Component after component.
<h2>How to Start?</h2>
So, you want to contribute to an Open Source project? It's useful to learn some ground rules first.

Perfect starting point are the <a title="Symfony2 Coding Standards" href="http://symfony.com/doc/2.0/contributing/code/standards.html">coding standards</a>. It's good to speak the same language as other developers.

Next stop is the <a title="Creating Patches to Symfony2" href="http://symfony.com/doc/2.0/contributing/code/patches.html">patches</a> chapter of the Symfony Documentation. You'll learn how to work on your own fork of Symfony and make that your contributions are merged into the core. You'll also read about the tools needed in the process. If you're not familiar with git than I highly recommend reading the <a title="Pro Git" href="http://progit.org/book/">Pro Git book</a>.

Finally, <a title="Running Symfony2 Tests" href="http://symfony.com/doc/2.0/contributing/code/tests.html">Running Symfony2 Tests</a> will show you how to run the test suite and code coverage.

After reading these docs you should be able to fork the<a title="Symfony on github" href="http://github.com/symfony/symfony"> Symfony repository on github</a>, clone it locally and run the tests:
<pre>phpunit</pre>
<p style="text-align: center;"><a href="/uploads/wp/2011/03/phpunit-output.png"><img class="size-medium wp-image-636 aligncenter" title="Output of PHPUnit run on the Symfony2 Code Base" src="/uploads/wp/2011/03/phpunit-output-400x128.png" alt="" width="400" height="128" /></a></p>

<h2>Code Coverage is our Friend</h2>
Code Coverage tells us what parts of the code base are covered by tests. We can generate a nice code coverage report in html with PHPUnit:
<pre>phpunit --coverage-html=cov</pre>
<a href="/uploads/wp/2011/03/symfony2-test-coverage.png"><img class="aligncenter size-medium wp-image-637" title="Symfony2 Test Coverage Report" src="/uploads/wp/2011/03/symfony2-test-coverage-400x114.png" alt="" width="400" height="114" /></a>

<a href="/uploads/wp/2011/03/symfony2-test-coverage.png"></a>The report not only shows us which classes or methods are tested. We can also see which lines were invoked while running the tests (and how many times). This makes the report a perfect tool for finding parts of code which are not fully tested yet.

<a href="/uploads/wp/2011/03/symfony2-class-test-coverage.png"><img class="aligncenter size-medium wp-image-638" title="Symfony2 Test Coverage Report (Class View)" src="/uploads/wp/2011/03/symfony2-class-test-coverage-400x104.png" alt="" width="400" height="104" /></a>

<a href="/uploads/wp/2011/03/symfony2-class-test-coverage.png"></a>Unfortunately it won't show us if all the execution paths were run.

I also noticed that to get a real test coverage of a given component it's better to run the coverage report for that component only. It's because some components use other components. <strong>The fact that code is executed while running the test doesn't mean its behavior is verified.</strong>

<strong><a href="/uploads/wp/2011/03/symfony2-components-test-coverage.png"><img class="aligncenter size-medium wp-image-657" title="Symfony2 Components Test Coverage" src="/uploads/wp/2011/03/symfony2-components-test-coverage-400x266.png" alt="" width="400" height="266" /></a>
</strong>

&nbsp;
