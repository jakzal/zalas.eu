<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Creating parametrized command line scripts in PHP with Symfony2 Console component &mdash; Jakub Zalas &mdash; Agile Software Engineer</title>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="verify-v1" content="PBznb5+bhxbUdD7HvioYYudpqitFdLDgjQTv8SwALq4=" />        <meta name="keywords" content="Symfony,components,console">
                <meta name="description" content="Symfony&#039;s Console component makes creating commands in PHP fun.">
                    <meta name="robots" content="index, follow">
        <link rel="shortcut icon" href="http://zalas.eu/favicon.ico" />
        <link rel="alternate" type="application/atom+xml" href="http://zalas.eu/atom.xml" title="Jakub Zalas activity feed" />
        <link href="http://zalas.eu/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="http://zalas.eu/css/base.css" rel="stylesheet" type="text/css" />
        <link href="http://zalas.eu/css/code.css" rel="stylesheet" type="text/css" />
        <link href="http://zalas.eu/components/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
                                    </head>
    <body>
        <div class="container">
            <div class="row">
                        <section itemscope itemtype="http://schema.org/BlogPosting">
        <h1 itemprop="name">Creating parametrized command line scripts in PHP with Symfony2 Console component</h1>
        <div class="post-date pull-right">
            <time itemprop="datePublished" content="2011-07-04" datetime="2011-07-04">04 Jul 2011</time>
        </div>
        <ul class="list-unstyled list-inline post-tag-cloud">
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/cli/">
                    <span class="list-group-item-heading">cli</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/components/">
                    <span class="list-group-item-heading">components</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/Console/">
                    <span class="list-group-item-heading">Console</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/php/">
                    <span class="list-group-item-heading">php</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/Symfony2/">
                    <span class="list-group-item-heading">Symfony2</span>
                </a>
            </li>
                    </ul>

                <div class="alert alert-danger">
            <strong>Warning</strong>: This blog post was written a long time ago and might be no longer relevant.
        </div>
        
        <section class="content" itemprop="articleBody"><div class="pull-left">
    <a href="/uploads/wp/2011/07/console.png"><img src="/uploads/wp/2011/07/console-150x150.png" title="Symfony Console" alt="Symfony Console" class="img-responsive" /></a>
</div>

<p>Symfony <a href="https://github.com/symfony/Console">Console component</a> enables us to create commands in PHP. It does all the nasty work of handling input and output.</p>

<div class="alert alert-warning">

<p><strong>Note</strong>: Code used in this post is available on github: <a href="https://github.com/jakzal/SymfonyComponentsExamples">https://github.com/jakzal/SymfonyComponentsExamples</a></p>

</div>

<h2 id="installation">Installation</h2>

<p>You can either install it from the <a href="http://pear.symfony.com/">Symfony PEAR channel</a> or grab it <a href="https://github.com/symfony/Console">directly from github</a>. For the purpose of this article we'll clone the sources to the <em>vendor/</em> directory of the project.</p>

<pre><code class="bash">git clone https://github.com/symfony/Console.git vendor/Symfony/Component/Console
</code></pre>

<p>We'll let Symfony ClassLoader component to take care of the class autoloading. Read more about it in the "<a href="http://zalas.eu/autoloading-classes-in-any-php-project-with-symfony2-classloader-component/">Autoloading classes in an any PHP project with Symfony2 ClassLoader component</a>".</p>

<p>Following code is sufficient to load classes from any Symfony component (assuming components are put into the <em>vendor/Symfony/Component</em> directory):</p>

<pre><code class="php">&lt;?php
// src/autoload.php
require_once __DIR__.'/../vendor/Symfony/Component/ClassLoader/UniversalClassLoader.php';

$loader = new Symfony\Component\ClassLoader\UniversalClassLoader();
$loader-&gt;registerNamespaces(array(
    'Symfony' =&gt; __DIR__.'/../vendor',
    'PSS'     =&gt; __DIR__
));
$loader-&gt;register();
</code></pre>

<p>PSS namespace is there for our classes.</p>

<h2 id="creating-console-application">Creating console application</h2>

<p>Console application will help us to manage commands:</p>

<pre><code class="php">&lt;?php
// console.php
require_once __DIR__.'/src/autoload.php';

use Symfony\Component\Console as Console;

$application = new Console\Application('Demo', '1.0.0');
$application-&gt;run();
</code></pre>

<p>If we run the script in command line without arguments, we'll get a nice overview of options and commands available by default.</p>

<div class="text-center">
    <a href="/uploads/wp/2011/06/console-options.png"><img src="/uploads/wp/2011/06/console-options-400x241.png" title="Symfony Console options" alt="Symfony Console options" class="img-responsive" /></a>
</div>

<p>There are two built in commands: help and list.</p>

<h2 id="creating-a-command">Creating a command</h2>

<p>To create a command we have to extend base Command class and implement its <em>execute()</em> method.</p>

<pre><code class="php">&lt;?php
// src/PSS/Command/HelloWorldCommand.php
namespace PSS\Command;

use Symfony\Component\Console as Console;

class HelloWorldCommand extends Console\Command\Command
{
    protected function execute(Console\Input\InputInterface $input, Console\Output\OutputInterface $output)
    {
        $output-&gt;writeln('Hello World!');
    }
}
</code></pre>

<p>Method takes input and output as its parameters. We'll use input to get options and arguments passed to the script. Output is handy whenever we want to print something out.</p>

<p>Each command has to be registered in the application:</p>

<pre><code class="php">&lt;?php
// console.php
require_once __DIR__.'/src/autoload.php';

use Symfony\Component\Console as Console;

$application = new Console\Application('Demo', '1.0.0');
$application-&gt;add(new PSS\Command\HelloWorldCommand('hello-world'));
$application-&gt;run();
</code></pre>

<p>If we run the script without parameters our command will be listed among default ones now.</p>

<p>We need to pass a command name to the script as a first argument to run it:</p>

<pre><code class="bash">php console.php hello-world
</code></pre>

<p>As a result we should see "<em>Hello World!</em>" printed out to the screen.</p>

<h2 id="adding-arguments-and-options">Adding arguments and options</h2>

<p>Arguments and options are used to parametrize and alter behavior of commands.</p>

<p>We'll modify our simple HelloWorld command to accept name as an argument. We'll output it to the screen.  "--more" option will make that additional message is displayed.</p>

<p>Arguments and options can be declared with the <em>addArgument()</em> and <em>addOption()</em> Command methods. We can make them optional or required, give description and default values.</p>

<p>Parameters given in the command line can be later taken from <em>$input</em> parameter which is passed to the <em>execute()</em> method (Application takes care of the details).</p>

<pre><code class="php">&lt;?php
// src/PSS/Command/HelloWorldCommand.php
namespace PSS\Command;

use Symfony\Component\Console as Console;

class HelloWorldCommand extends Console\Command\Command
{
    public function __construct($name = null)
    {
        parent::__construct($name);

        $this-&gt;setDescription('Outputs welcome message');
        $this-&gt;setHelp('Outputs welcome message.');
        $this-&gt;addArgument('name', Console\Input\InputArgument::OPTIONAL, 'The name to output to the screen', 'World');
        $this-&gt;addOption('more', 'm', Console\Input\InputOption::VALUE_NONE, 'Tell me more');
    }

    protected function execute(Console\Input\InputInterface $input, Console\Output\OutputInterface $output)
    {
        $name = $input-&gt;getArgument('name');

        $output-&gt;writeln(sprintf('Hello %s!', $name));

        if ($input-&gt;getOption('more')) {
            $output-&gt;writeln('It is really nice to meet you!');
        }
    }
}
</code></pre>

<p>Now we can use new argument and option in the command line:</p>

<pre><code class="bash">php console.php hello-world -m Kuba
</code></pre>

<p>Additional calls to <em>setDescription()</em> and <em>setHelp()</em> in the constructor set the command description and help. It's handy when we distribute our script. End user can now get help with:</p>

<pre><code class="bash">php console.php help hello-world
</code></pre>

<div class="alert alert-warning">

<p><strong>Note</strong>: Built in help command is responsible for printing out the message.</p>

</div>

<div class="text-center">
    <a href="/uploads/wp/2011/06/console-help.png"><img src="/uploads/wp/2011/06/console-help-400x158.png" title="Symfony Console help" alt="Symfony Console help" class="img-responsive" /></a>
</div>

<h2 id="interactive-shell">Interactive shell</h2>

<p>By wrapping an application into a Shell object we can easily gain functionality of interactive shell.</p>

<pre><code class="php">&lt;?php
// consoleshell.php
require_once __DIR__.'/src/autoload.php';

use Symfony\Component\Console as Console;

$application = new Console\Application('Demo', '1.0.0');
$application-&gt;add(new PSS\Command\HelloWorldCommand('hello-world'));

$shell = new Console\Shell($application);
$shell-&gt;run();
</code></pre>

<p>The script won't terminate but will wait for our commands:</p>

<pre><code class="bash">php consoleshell.php
</code></pre>

<div class="text-center">
    <a href="/uploads/wp/2011/06/console-shell.png"><img src="/uploads/wp/2011/06/console-shell-363x400.png" title="Symfony Console Shell" alt="Symfony Console Shell" class="img-responsive" /></a>
</div>
</section>
    </section>


        <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'zalas';
        var disqus_identifier = 'creating-parametrized-command-line-scripts-in-php-with-symfony2-console-component';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
            </div>
        </div>
                                <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-607315-8', 'auto');
                ga('send', 'pageview');
            </script>
            
            
            <script src="http://zalas.eu/components/highlightjs/highlight.pack.js"></script>
            <script>hljs.initHighlightingOnLoad();</script>
                    </body>
</html>
