<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Things I like about the new Symfony2 Form Component &mdash; Jakub Zalas &mdash; Agile Software Engineer</title>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="verify-v1" content="PBznb5+bhxbUdD7HvioYYudpqitFdLDgjQTv8SwALq4=" />            <meta name="robots" content="index, follow">
        <link rel="shortcut icon" href="http://zalas.eu/favicon.ico" />
        <link rel="alternate" type="application/atom+xml" href="http://zalas.eu/atom.xml" title="Jakub Zalas activity feed" />
        <link href="http://zalas.eu/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="http://zalas.eu/css/base.css" rel="stylesheet" type="text/css" />
        <link href="http://zalas.eu/css/code.css" rel="stylesheet" type="text/css" />
        <link href="http://zalas.eu/components/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
                                    </head>
    <body>
        <div class="container">
            <div class="row">
                        <section itemscope itemtype="http://schema.org/BlogPosting">
        <h1 itemprop="name">Things I like about the new Symfony2 Form Component</h1>
        <div class="post-date pull-right">
            <time itemprop="datePublished" content="2011-03-29" datetime="2011-03-29">29 Mar 2011</time>
        </div>
        <ul class="list-unstyled list-inline post-tag-cloud">
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/doctrine2/">
                    <span class="list-group-item-heading">doctrine2</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/form/">
                    <span class="list-group-item-heading">form</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/onTheEdge/">
                    <span class="list-group-item-heading">onTheEdge</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/php/">
                    <span class="list-group-item-heading">php</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/Symfony2/">
                    <span class="list-group-item-heading">Symfony2</span>
                </a>
            </li>
                        <li>
                <span class="glyphicon glyphicon-tag"></span>
                <a href="http://zalas.eu/tag/twig/">
                    <span class="list-group-item-heading">twig</span>
                </a>
            </li>
                    </ul>

                <div class="alert alert-danger">
            <strong>Warning</strong>: This blog post was written a long time ago and might be no longer relevant.
        </div>
        
        <section class="content" itemprop="articleBody"><div class="pull-left">
    <img src="/uploads/wp/2011/03/sflogo.png" title="Symfony logo" alt="Symfony logo" class="img-responsive" />
</div>

<p>Forms Refactoring, the last big change and recently <a href="https://github.com/symfony/symfony/pull/399">most awaited pull request</a> for Symfony2, was finally finished last Sunday. The work is not fully done but it's ready for merge. Request is still waiting for approval and as soon as it's accepted (or rejected) we can expect a beta release.</p>

<p>So what is it about?</p>

<p>Refactoring is mainly about a proper usage of the dependency injection and decoupling parts of the component. It mostly affects the way we'll create the form and related objects. We can already see it in action in <a href="https://github.com/beberlei/AcmePizzaBundle">an example project</a> or <a href="https://gist.github.com/883293">Gist snippets</a>.</p>

<p>It's not guaranteed that the pull request will be accepted in its current state. Things might change but I already took a deeper look into the component. There are several things I really like about it. Most of it will get into the final release of the framework anyway. Only object construction is under the question.</p>

<h2 id="configuration">Configuration</h2>

<p>Forms will no longer be composed of widget objects like they used to be in symfony 1.x. Future process of defining a form looks more like a configuration:</p>

<pre><code class="php">$form = $this-&gt;get('form.factory')
    -&gt;createBuilder('form')
    -&gt;add('name', 'text')
    -&gt;add('price', 'money', array('currency' =&gt; 'USD'))
    -&gt;getForm();
</code></pre>

<p>As you can notice we retrieve a form factory service from the service container, create a builder and use it to define the form. This is one of the biggest changes made in the pull request. Notice no new object is explicitly created with a constructor. It not only delays object creation until it's really needed but also lets us to change injected type by modifying service definitions.</p>

<h2 id="popo">POPO</h2>

<p>Forms don't expect any specific data object but can effectively work with any Plain Old PHP Object:</p>

<pre><code class="php">class Pizza
{
    private $name = null;

    private $price = null;

    public function setName($name)
    {
        $this-&gt;name = $name;
    }

    public function getName()
    {
        return $this-&gt;name;
    }

    public function setPrice($price)
    {
        $this-&gt;price = $price;
    }

    public function getPrice()
    {
        return $this-&gt;price;
    }
}
</code></pre>

<p>All we need to do is to pass an object to the form:</p>

<pre><code class="php">$pizza = new Pizza();
$pizza-&gt;setName('Capriciosa');
$pizza-&gt;setPrice(35.00);

$form-&gt;setData($pizza);
</code></pre>

<h2 id="guessing-the-field-types">Guessing the field types</h2>

<p>Although forms might work with any object we can take advantage of an ORM as well. For example, forms are able to determine the field types when used with Doctrine entities:</p>

<pre><code class="php">$form = $this-&gt;get('form.factory')
    -&gt;createBuilder('form', 'product', array('data_class' =&gt; 'Acme\PizzeriaBundle\Entity\Pizza'))
    -&gt;add('name')
    -&gt;add('price');
</code></pre>

<p>Defining <em>data_class</em> enables form to look at the type definitions for given class:</p>

<pre><code class="php">namespace Acme\PizzeriaBundle\Entity;

/**
 * @orm:Entity
 * @orm:Table(name="pizzas")
 */
class Pizza
{
    /**
     * @orm:Column(type="string", length="255")
     */
    private $name = null;

    /**
     * @orm:Column(type="decimal", precision=2)
     */
    private $price = null;

    // ...
}
</code></pre>

<h2 id="validation">Validation</h2>

<p>Validation is no longer a form responsibility. It's finally back to where it belongs; in the model.</p>

<pre><code class="php">class Pizza
{
    /**
     * @assert:NotBlank(message="Name cannot be left blank")
     */
    private $name = null;

    /**
     * @assert:NotBlank(message="You have to give a price")
     * @assert:Min(0)
     */
    private $price = null;
}
</code></pre>

<p>Form knows nothing about the validation. It just asks the related entity whether it has a valid data.</p>

<h2 id="form-templates">Form Templates</h2>

<p>In symfony 1.x form widgets are rendered by the widget class itself. Clearly it's not the right place for a template in an MVC framework.</p>

<p>In Symfony 2 it was fixed by introducing a special template for widgets. All the widgets are defined in its own block. This way we can easily extend chosen widgets or even add new ones.</p>

<p>Here's an example of twig template taken from the <a href="http://symfony.com/doc/2.0/book/forms/view.html#defining-the-html-representation">Symfony documentation</a>:</p>

<pre><code class="jinja">
{% block textarea_field %}
    &lt;textarea {% display field_attributes %}&gt;{{ field.displayedData }}&lt;/textarea&gt;
{% endblock textarea_field %}

</code></pre>

<div class="alert alert-warning">

<p><strong>Edit</strong> (<em>30.03.2011</em>): changed validation into assert as @<a href="http://twitter.com/webmozart">webmozart</a> suggested. Added examples of validation messages.</p>

</div>
</section>
    </section>


        <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'zalas';
        var disqus_identifier = 'things-i-like-about-new-symfony2-form-component';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
            </div>
        </div>
                                <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-607315-8', 'auto');
                ga('send', 'pageview');
            </script>
            
            
            <script src="http://zalas.eu/components/highlightjs/highlight.pack.js"></script>
            <script>hljs.initHighlightingOnLoad();</script>
                    </body>
</html>
